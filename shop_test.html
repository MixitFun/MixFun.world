<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hahaha!!! Watch this, you will like it!</title>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="icon" href="img/logo.png" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap-grid.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap-reboot.css"/>
    <link rel="stylesheet" href="css/font-awesome.css"/>
</head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138276305-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-138276305-1', {
        'page_title' : 'MixFun',
        'page_path': '/player'
    });
</script>
<script src="https://code.jquery.com/jquery-3.4.0.js"></script>

<style>
    .footer{
        background-color: #6c757d;
        opacity:0.8;
        z-index: 999;
        position: fixed;
        width: 100%;
        bottom: 0;
        padding: 10px;
    }
    .content{
        position: relative;
        min-height: 100%;
    }

    img, object {
        max-width: 100%;
    }

    .topImage {
        float: left;
        width: 45%;
        margin-left: 3.3%;
        margin-bottom: 3%;
    }
</style>
<body style="background-color: #f9f9f9">
<div id="container">
    <div id="content" class="container-fluid content" style="padding-top: 10px;min-height: 100%; background-color: white">
        <div id="video" style="display: none; margin-bottom: 10px">
            <video id="player" style="width: 100%;" preload="auto" controls="controls">
                <source id="source" type="video/mp4"/>
                <track>
            </video>
        </div>
        <div id="image" style="margin-bottom: 15px">
            <img id="img" style="width: 100%;">
        </div>
        <div id="contentDiv">
            <p id="contentString" style="white-space: pre-wrap"></p>
        </div>
        <div style="padding-bottom: 10px">
            <row style="text-align: center; display: block;">
                <a class="col-3" style="margin: auto; margin-right: 25%"><img src="img/icon_claps.png" style="width: 25px"> <span id="claps" style="color: #7abaff"></span></a>
                <a class="col-3" style="margin: auto;"><img src="img/icon_comment.png" style="width: 25px"> <span id="comments" style="color: #7abaff"></span></a>
            </row>
            <p id="title" style="margin-top: 10px"></p>
        </div>
    </div>

    <div align="center">
        <p style="margin-top: 10px">Top List</p>
        <div id="videoListDiv"></div>
    </div>

    <div id="footer" class="footer">
        <div class="row" vertical-align>
            <div class="col-8" style="display: inline-flex; padding-right: 0px">
                <img src="img/mixit-logo.png" style="height: 50px;width: 50px;">
                <p style="color: white; margin-left: 10px; margin-bottom: 0px">MixFun - Funny videos & pics sharing community</p>
            </div>
            <div class="col-4" style="margin: auto">
                <a class="btn btn-info" href="https://app.mixfun.world/share" style="float: right;">Download</a>
            </div>
        </div>
    </div>
</div>
</body>

<script type="text/javascript">
    $( document ).ready(function() {
        let footerHeight = document.getElementById('footer').clientHeight;
        $('#container').css('margin-bottom', footerHeight+"px");
    });

    function GetRequest() {
        var url = location.search;
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }

    vi = GetRequest().id;
    var baseUrl = "https://api.mixit.fun/";
    //   var baseUrl = "http://34.87.14.19:7001/";
    $(document).ready(function() {
        var type = 1;
        var userAgentInfo = navigator.userAgent;

        if (userAgentInfo.indexOf('iPhone') > 0) {
            type = 2;
        } else if (userAgentInfo.indexOf('Android') > 0) {
            type = 3;
        }

        if (type === 1) {
            $('#content').attr('style', 'width:70%');
            var clientHeight = document.body.clientHeight/2;
            $('video').css('height',clientHeight);
        }

        $.get(baseUrl+'dynamic/getInfo?id='+vi, function (data) {
            $('title').html(data.data.title);
            if (data.data.user.avatar != null) {
                $('#avatar').attr('src', data.data.user.avatar);
            }
            $('#nickname').text(data.data.user.nickname);
            $('#claps').text(data.data.myClaps);
            $('#comments').text(data.data.myComments);
            $('#title').text(data.data.title);
            if (data.data.type == 1){
                $('#video').css('display','block');
                $('#source').attr('src', data.data.playUrl);
                $('video').attr('poster', data.data.thumbnailUrl);
                $('video').attr('atuoplay', true);
                $('video').css('background-color', 'black');
                document.getElementById('player').load();
                $('#image').css('display','none');
                $('#contentDiv').css('display','none');
                $('#play').click();
            } else if(data.data.type == 3){
                $('#img').attr('src', data.data.thumbnailUrl);
                $('#video').css('display','none');
                $('#contentDiv').css('display','none');
                $('#img').css('src', data.data.thumbnailWidth);
                $('#img').css('src', data.data.thumbnailheight);
            } else if (data.data.type == 4) {
                $('#video').css('display','none');
                $('#image').css('display','none');
                $('#contentString').text(data.data.content);
                $('#title').css('display','none');
            }
        });
        getTopList();
    });

    function getTopList() {
        $.ajax({
            method: 'post',
            url: baseUrl+'dynamic/page/top',
            data: JSON.stringify({
                pageSize: 10,
                pageNum: 1
            }),
            contentType:'application/json',
            dataType: 'json',
            success: function(data) {
                var htStr = '<table style="width: 100%; text-align: center; line-height: 26px; margin-bottom: 15px">';
                data.data.forEach(function(item, index) {
                    let playURL = item.thumbnailUrl;
                    let imageURL = item.playUrl;
                    htStr += '<img class="topImage" src="'+imageURL+'">'
                    // htStr += '<tr>';
                    // htStr += '<td style="width: 45%"><div><video poster='+imageURL+' preload="auto" controls="controls" style="width: 45%"><source src='+playURL+' type="video/mp4"><track></video></div></td>';
                    // htStr += '</tr>';
                });
                //               htStr += '</table>';
                $('#videoListDiv').html(htStr);
            }
        });
    }

</script>
</html>