<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Details</title>
    <link rel="icon" href="img/logo.png" type="image/x-icon">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta property="og:url" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="" />
    <meta property="og:description" content="" />
    <meta property="og:image" content="images/share-logo.png" />
    <link rel="icon" href="img/logo.png" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap-grid.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap-reboot.css"/>
</head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138276305-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-138276305-1', {
        'page_title' : 'MixFun',
        'page_path': '/task_detail'
    });
</script>
<script src="https://code.jquery.com/jquery-3.4.0.js"></script>
<script type="text/javascript" src="js/platform.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/bootstrap.bundle.js"></script>
<script src="js/clipboard.min.js"></script>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.3"></script>

<body>
<div style="width: 100%; height: 25%; background-color: #FEC444; position: relative">
    <img id="taskImage">
    <p class="TaskName" id="taskName"></p>
</div>
<div id="taskDiv" style="position: absolute; width: 100%; display: none">
    <h6 style="margin-top: 8%; margin-left: 6%; font-size: 16px;" id="descriptionID"></h6>
    <ul id="normalul"></ul>
    <div align="center">
        <button class="btn" style="width: 70%; height: 44px; margin-top: 8%; background-color: #FEC444; color: white;font: 18px PingFangSC-Regular, sans-serif;" onclick="downloadAction()">Start Task</button>
        <button id="tempDownloadBtn" style="display: none;"></button>
    </div>
</div>
<div id="referDiv" style="width: 100%; display: none;">
    <p style="margin: 6% 5% 0 5%; font-size: 15px;">Send this referral code to your friends or share below links to get reward.</p>
    <div align="center">
        <div align="center" style="margin-top: 6%;">
            <p id="referCode" style="font-size: 27px; font-weight: 600; color: #F45D90; display: inline-block"></p>
            <button class="btn copyBtn" style="background-image: url(img/icon_copy.png); background-size: cover; border: 0; margin-left: 30px; margin-top: -10px; display: inline-block" onclick="copy('code')"></button>
        </div>
        <div>
            <div style="display: inline-block; margin-top: 5%; margin-right: 20%">
                <button class="btn shareBtn" id="shareFacebookBtn" style="background-image: url(img/icon_facebook.png);"></button>
                <p class="shareBtnTitle">Facebook</p>
            </div>
            <div style="display: inline-block; margin-top: 5%">
                <button class="btn copyBtn" style="background-image: url(img/icon_ic_link.png);" onclick="copy('link')"></button>
                <p class="shareBtnTitle">Link</p>
            </div>
        </div>
    </div>
</div>

<!-- alert -->
<div class="modal fade" id="tot" tabindex="-1" role="dialog" aria-labelledby="Box" aria-hidden="true" style="margin-top: 20%; z-index: 9999">
    <div class="modal-dialog" role="document" style="border-radius: 20px;height: 100%">
        <div class="modal-content" style="border-radius: 20px;">
            <div class="modal-body">
                <h5 class="modal-title" id="copy_label"></h5>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ModalAlert" tabindex="-1" role="dialog" aria-labelledby="ModalNoticeTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document" style="border-radius: 20px;">
        <div class="modal-content" style="border-radius: 20px;">
            <div class="modal-header" style="background: linear-gradient(to right, #b4d0ef, #e4f1f8);border-radius: 20px 20px 0 0;">
                <h5 class="modal-title" id="ModalNoticeTitle">Message</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="alert"></div>
        </div>
    </div>
</div>

<div class="modal fade" id="zzd" tabindex="-1" role="dialog" aria-labelledby="Box" aria-hidden="true" style="margin-top: 20%;" align="center">
    <div class="modal-dialog" role="document" style="border-radius: 20px;height: 100%">
        <div class="spinner-grow text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-secondary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-success" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-danger" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-warning" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-info" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-light" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-dark" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>
</body>

<style>
    .btn:focus,
    .btn:active:focus,
    .btn.active:focus,
    .btn.focus,
    .btn:active.focus,
    .btn.active.focus {
        box-shadow:none;
    }

    html,body{
        height:100%;
        width:100%;
        background-color: white;
    }

    div img {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 6%;
        margin: auto;
        border-radius: 6px 6px 6px 6px;
        width: 20%;
        -webkit-box-shadow:0px 0px 5px 3px #d2aeae;
        -moz-box-shadow:0px 0px 5px 3px #d2aeae;
        box-shadow:0px 0px 5px 3px #a59f9f;
    }

     .TaskName {
         position: absolute;
         top: 30%;
         bottom: 0;
         left: 30%;
         margin: auto;
        font-weight: 400;
         font-size: 18px;
        color: white;
    }

    li{
        font-size: 14px;
        margin-right: 5%;
    }

    .shareBtnTitle {
        font-size: 11px;
        color: gray;
        margin-top: 5px;
    }

    .shareBtn, .copyBtn {
        margin-top: 5%; 
        padding: 16px;
        background-size: cover;
    }
</style>

<script type="text/javascript">
    var baseUrl = "https://api.mixit.fun/";

    var body = document.body,
        html = document.documentElement;

    var height = Math.max( body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight, html.offsetHeight );
    $('#zzd').css('margin-top',height/2);

    $('.modal').on("hidden.bs.modal", function () {
        if($('.modal:visible').length)
        {
            $('.modal-backdrop').first().css('z-index', parseInt($('.modal:visible').last().css('z-index')) - 10);
            $('body').addClass('modal-open');
        }
    }).on("show.bs.modal", function (e) {
        if($('.modal:visible').length)
        {
            $('.modal-backdrop.in').first().css('z-index', parseInt($('.modal:visible').last().css('z-index')) + 10);
            $(this).css('z-index', parseInt($('.modal-backdrop.in').first().css('z-index')) + 10);
        }
    });

    $('#tot').on('shown.bs.modal', function (e) {
        setTimeout(function () {
            $('#tot').modal('hide');
        },500)
    })

    function GetRequest() {
        var url = location.search;
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
    let downloadURL = GetRequest().url;
    let taskCode = GetRequest().code;
    let taskName = GetRequest().name;
    let taskCoin = GetRequest().coin;
    let token = GetRequest().token;

    var regionCode = "ph";
    var addJSFunction = true;
    if (platform.os.toString().indexOf('Android') > -1) {
        try {
            regionCode = window.android.getRegionCode();
            JSBridgeComplete();
        } catch (e) {
            JSBridgeComplete();
        }
    } else if (platform.os.toString().indexOf('iOS') > -1) {
        function setupWebViewJavascriptBridge(callback) {
            if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
            if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
            window.WVJBCallbacks = [callback];
            var WVJBIframe = document.createElement('iframe');
            WVJBIframe.style.display = 'none';
            WVJBIframe.src = 'https://__bridge_loaded__';
            document.documentElement.appendChild(WVJBIframe);
            setTimeout(function() {
                document.documentElement.removeChild(WVJBIframe);
            }, 0)
        }

        setupWebViewJavascriptBridge(function(bridge) {
            addJSFunction = false;
            document.getElementById('shareFacebookBtn').onclick = function () {
                let facebookURL = "https://www.facebook.com/sharer.php?title="+shareTitle+"&u="+downloadURL+"";
                bridge.callHandler('openURL', {'url': facebookURL}, function(response) {
                });
            };
            document.getElementById('tempDownloadBtn').click = function () {
                bridge.callHandler('openURL', {'url': downloadURL}, function(response) {
                });
            };
            bridge.callHandler("getRegionCode", null, function(response) {
                regionCode = response;
                JSBridgeComplete();
            });
        })
    } else {
        JSBridgeComplete();
    }

    let shareTitle = "I would like to refer you to join MixFun. Sign up with my link, both of us will get Mixcoin!\n";
    function JSBridgeComplete() {
        if (addJSFunction) {
            document.getElementById('shareFacebookBtn').onclick = function () {
                let facebookURL = "https://www.facebook.com/sharer.php?title="+shareTitle+"&u="+downloadURL+"";
                try {
                    window.android.BackToAndroid(facebookURL);
                } catch (e) {
                    window.location.href = facebookURL;
                }
            };
            document.getElementById('tempDownloadBtn').click = function () {
                try {
                    window.android.BackToAndroid(downloadURL);
                } catch (e) {
                    window.location.href = downloadURL;
                }
            };
        }
        if (regionCode == "ph") {
            $('#registLi').text("Kailangang matapos ang REGISTRATION");
        }
    }

    createContext();
    var shareCode;
    function createContext() {
        var descriptionStr = 'Description';
        if (taskCode == 'refer') {
            $('#descriptionID').text(descriptionStr);
            $('#referDiv').css('display', 'block');
            let strArr = downloadURL.split('c=');
            if (strArr.length > 1) {
                shareCode = strArr.slice(-1);
                $('#referCode').html(shareCode);
            }
            $('#shareURL').html(downloadURL);
        } else if (taskCode == 'Reloco') {
            $('#descriptionID').text(descriptionStr);
            var htmlStr = '<li>Like Reloco Facebook Page</li>';
            htmlStr += '<li>Random 100 Likers will be picked to win 1000PHP valued Couple Watch</li>';
            $('#normalul').html(htmlStr);
            $('#taskDiv').css('display', 'block');
        } else if (taskCode == 'InstagramId' || taskCode == 'InstagramPh') {
            descriptionStr = 'Please follow us on Instagram';
            $('#descriptionID').text(descriptionStr);
            var htmlStr = '<li>It takes just 10seconds and this will help to grow the community and provide better tasks.</li>';
            $('#normalul').html(htmlStr);
            $('#taskDiv').css('display', 'block');
        } else if (taskCode == 'YouTube') {
            descriptionStr = 'Please follow us on YouTube';
            $('#descriptionID').text(descriptionStr);
            var htmlStr = '<li>It takes just 10seconds and this will help to grow the community and provide better tasks.</li>';
            $('#normalul').html(htmlStr);
            $('#taskDiv').css('display', 'block');
        } else if (taskCode == 'FacebookId' || taskCode == 'FacebookId') {
            descriptionStr = 'Please follow us on Facebook';
            $('#descriptionID').text(descriptionStr);
            var htmlStr = '<li>It takes just 10seconds and this will help to grow the community and provide better tasks.</li>';
            $('#normalul').html(htmlStr);
            $('#taskDiv').css('display', 'block');
        } else {
            $('#descriptionID').text(descriptionStr);
            var htmlStr = '<li>New users only</li>';
            htmlStr += '<li>Register or complete tutorial, if asked so</li>';
            htmlStr += '<li>Don’t change between network</li>';
            htmlStr += '<li id="registLi" style="font-size: 16px; font-weight: 700; color: crimson">Must finished REGISTRATION</li>';
            $('#normalul').html(htmlStr);
            $('#taskDiv').css('display', 'block');
        }
        document.getElementById('taskImage').src = 'img/'+taskCode+'_img.png';
        taskName = taskName.substr(1);
        taskName = taskName.substr(0, taskName.length-1);
        taskName += "</br>"+taskCoin+"&nbsp;Mixcoin";
        $('#taskName').html(taskName);
    }

    function downloadAction() {
        $.ajax({
            method: 'post',
            url: baseUrl+'task/start',
            headers:{
                authorization:token
            },
            data: JSON.stringify({
                code:taskCode
            }),
            contentType:'application/json',
            dataType: 'json',
            success: function(data) {
                if(data.status == 0){
                    $('#zzd').modal('show');
                }else{
                    $('#alert').html('<p>'+data.msg+'</p>');
                    $('#ModalAlert').modal('show');
                }
                $('#zzd').on('shown.bs.modal',function () {
                    let timeout = setTimeout(function () {
                        $('#zzd').modal('hide');
                    },1200);
                });
            }
        });
        $('#zzd').on('hide.bs.modal', function () {
            $('#tempDownloadBtn').click();
            gtag('event', 'task_detail',{
                'event_category': 'start_task',
                'event_label': taskCode,

                'value': 1
            });
        })
    }

    let clip = new ClipboardJS('.copyBtn', {
        text: function(trigger) {
            if (copyType == "code") {
                return shareCode;
            }  else {
                return downloadURL;
            }
        }
    });
    clip.on('successfully', function(e){
        clip.destroy();
    });

    var copyType;
    function copy(type) {
        copyType = type;
        $('#copy_label').text('Copied!');
        $('#tot').modal('show');
    }

</script>
</html>
